@import com.feth.play.module.pa.views.html.currentAuth
@import com.feth.play.module.pa.views.html.forProviders
@import play.data.Form

@(loginForm: Form[_])

@main("Battleship", views.html.index.getClass) {
    @defining(Application.getLocalUser(session)) { currentUser =>
        @if(currentUser != null) {
            <h1 class="page-header">Welcome to Battleship, @currentUser.name!</h1>
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h2>Online users</h2>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <td>#</td>
                                        <td>Username</td>
                                        <td class="pull-right">Status</td>
                                    </tr>
                                </thead>
                                <tbody id="onlineUsers" class="users">
                                @for(u <- OnlineController.getOnlineUsers) {
                                    @if(u != currentUser) {
                                        <tr id="@u.id">
                                            <td>@u.id</td>
                                            <td>@u.name</td>
                                            @if(u.isCurrentlyPlaying() == 0) {
                                                <td><a href="/playagainst/@u.id" class="btn btn-primary pull-right">Play!</a></td>
                                            } else {
                                                <td><button class="btn btn-default pull-right" disabled="disabled">Currently playing</button></td>
                                            }
                                        </tr>
                                    }
                                }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        } else {
            <h1>Welcome to Battleship!</h1>
            <div class="row">
                <div class="col-md-offset-3 col-md-6">
                    <div class="jumbotron">
                        @helper.form(routes.Application.doLogin) {
                            @if(loginForm.hasGlobalErrors) {
                                <ul class="alert alert-danger">
                                @for( error <- loginForm.globalErrors) {
                                    <li>@error.message</li>
                                }
                                </ul>
                            }

                            <h2 class="form-signin-heading">Login</h2>

                            @helper.inputText(loginForm("email"),
                                '_id -> "email",
                                '_label -> null,
                                '_showConstraints -> false,
                                'class -> "form-control",
                                'placeholder -> "Email")

                            @helper.inputPassword(loginForm("password"),
                                '_id -> "password",
                                '_label -> null,
                                '_showConstraints -> false,
                                'class -> "form-control",
                                'placeholder -> "Password")

                            <button class="btn btn-default" type="submit">Login</button>
                        }
                        <a href="/signup">Signup here</a>
                        <hr>
                        <h4>Or Login with:</h4>
                        <ul class="providers">
                        @forProviders() { p =>
                            <li>
                                <a href="@p.getUrl">@p.getKey</a>
                            </li>
                        }
                        </ul>
                        <br/> <br/>
                    </div>
                </div>
            </div>
        }
    }

    <script src="@routes.Assets.versioned("javascripts/dist/onlineusers.js")" type="text/javascript"></script>

}
